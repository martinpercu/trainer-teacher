<div class="max-w-4xl mx-auto mt-4 text-2xl font-bold text-neutral-800 dark:text-neutral-200 mb-4">
  Manage Exams
</div>

<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Manage Exams</h1>

  <!-- Mensaje de error -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    {{ errorMessage }}
  </div>

  <!-- Selección de examen existente -->
  <div class="mb-4">
    <label class="block text-gray-700 mb-2">Seleccionar Examen</label>
    <select
      class="w-full px-3 py-2 border rounded-md"
      [ngModel]="selectedExamId"
      (change)="loadExam($event)">
      <option value="">Nuevo examen</option>
      <option *ngFor="let exam of exams$ | async" [value]="exam.id">{{ exam.title }}</option>
    </select>
  </div>

  <!-- Formulario de examen -->
  <div class="bg-white shadow-md rounded-md p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Título del examen -->
      <div>
        <label class="block text-gray-700 mb-2">Título *</label>
        <input
          type="text"
          [(ngModel)]="newExam.title"
          class="w-full px-3 py-2 border rounded-md"
          placeholder="Título del examen">
      </div>

      <!-- Profesor -->
      <div>
        <label class="block text-gray-700 mb-2">Profesor *</label>
        <select
          [(ngModel)]="newExam.teacherId"
          (change)="updateTeacherName($event)"
          class="w-full px-3 py-2 border rounded-md">
          <option value="">Seleccionar profesor</option>
          <option *ngFor="let teacher of teachers$ | async" [value]="teacher.id">{{ teacher.name }}</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
      <!-- Porcentaje para aprobar -->
      <div>
        <label class="block text-gray-700 mb-2">Porcentaje para aprobar</label>
        <input
          type="number"
          [(ngModel)]="newExam.passingPercentage"
          class="w-full px-3 py-2 border rounded-md"
          min="0"
          max="100">
      </div>

      <!-- Tiempo de espera para reintentar -->
      <div>
        <label class="block text-gray-700 mb-2">Tiempo de espera (horas)</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToWait"
          class="w-full px-3 py-2 border rounded-md"
          min="0">
      </div>
    </div>

    <!-- Nuevos campos -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <!-- Habilitado -->
      <div>
        <label class="block text-gray-700 mb-2">Estado del examen</label>
        <div class="flex items-center">
          <input
            type="checkbox"
            [(ngModel)]="newExam.enable"
            class="w-5 h-5 text-blue-600">
          <span class="ml-2">Habilitado</span>
        </div>
      </div>

      <!-- Tiempo para hacer el examen -->
      <div>
        <label class="block text-gray-700 mb-2">Tiempo para realizar el examen (minutos)</label>
        <input
          type="number"
          [(ngModel)]="newExam.timeToDoTheExam"
          class="w-full px-3 py-2 border rounded-md"
          min="1">
      </div>
    </div>

    <!-- Preguntas -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-semibold">Preguntas</h2>
        <button
          type="button"
          (click)="addQuestion()"
          class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-600">
          Agregar Pregunta
        </button>
      </div>

      <div *ngIf="!newExam.questions?.length" class="text-gray-500 text-center py-4">
        No hay preguntas agregadas
      </div>

      <div *ngFor="let question of newExam.questions; let i = index" class="border p-4 rounded-md mb-4">
        <div class="flex justify-between items-start mb-3">
          <h3 class="font-medium">Pregunta {{ i + 1 }}</h3>
          <button
            type="button"
            (click)="removeQuestion(i)"
            class="text-red-500 hover:text-red-700">
            <mat-icon>delete</mat-icon>
          </button>
        </div>

        <div class="mb-3">
          <input
            type="text"
            [(ngModel)]="question.text"
            class="w-full px-3 py-2 border rounded-md"
            placeholder="Texto de la pregunta">
        </div>

        <div class="mb-2">
          <div class="flex justify-between items-center">
            <h4 class="font-medium">Opciones</h4>
            <button
              *ngIf="question.options.length < 6"
              type="button"
              (click)="addOption(i)"
              class="text-blue-500 hover:text-blue-700">
              <mat-icon>add_circle</mat-icon>
            </button>
          </div>
        </div>

        <div *ngFor="let option of question.options; let j = index" class="flex items-center mb-2">
          <input
            type="radio"
            [checked]="option.isCorrect"
            (change)="updateOptionCorrectness(i, j)"
            class="mr-2">
          <input
            type="text"
            [(ngModel)]="option.text"
            class="flex-grow px-3 py-2 border rounded-md"
            placeholder="Texto de la opción">
          <button
            *ngIf="question.options.length > 2"
            type="button"
            (click)="removeOption(i, j)"
            class="ml-2 text-red-500 hover:text-red-700">
            <mat-icon>remove_circle</mat-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Botones -->
    <div class="flex justify-between">
      <div>
        <button
          type="button"
          (click)="resetForm()"
          class="bg-gray-300 text-gray-800 px-4 py-2 rounded-md hover:bg-gray-400 mr-2">
          Limpiar
        </button>
        <button
          *ngIf="editingExamId"
          type="button"
          (click)="deleteExam()"
          class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"
          [disabled]="isSaving">
          Eliminar
        </button>
      </div>
      <button
        type="button"
        (click)="saveExam()"
        class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
        [disabled]="isSaving">
        {{ editingExamId ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>

